---
title: GritQL
description: Основы использования GritQL в Biome
---

GritQL — это язык запросов для выполнения структурного поиска в исходном коде.
Это означает, что такие мелочи, как пробелы или даже тип кавычек, используемых в
строках, будут игнорироваться в вашем поисковом запросе. Кроме того, он предлагает множество
функций, которые позволяют запрашивать структуру синтаксиса, такие как фрагменты кода, сопоставление,
вложенность и переменные.

GritQL является [открытым исходным кодом](https://github.com/getgrit/gritql/) и создан компанией [Grit.io](https://grit.io/).

Biome использует GritQL для двух целей:

- [Плагины анализатора](/linter/plugins).
- Команда [`biome search`](/reference/cli/#biome-search), которую мы надеемся
  расширить и на наши расширения для IDE.

## Шаблоны

Запросы GritQL работают через _шаблоны_. Наиболее распространенный шаблон, который вы увидите, это
фрагмент кода, который выглядит как обычный исходный код, заключенный в обратные кавычки:

```grit
`console.log('Hello, world!')`
```

Этот шаблон будет соответствовать любому вызову `console.log()`, которому передается строка
`'Hello, world!'`. Но поскольку GritQL выполняет _структурное_ сопоставление, ему не
важны детали форматирования. Это также соответствует:

```js
console.log (
    'Hello, world!'
)
```

И это тоже (обратите внимание на изменение кавычек):

```js
console.log("Hello, world!")
```

:::note
Большинство оболочек интерпретируют обратные кавычки как вызовы команд, что конфликтует с
фрагментами кода GritQL. Поэтому при использовании команды `biome search` лучше всего
заключать ваши Grit-запросы в _одинарные кавычки_:

```shell
biome search '`console.log($message)`' # найти все вызовы `console.log`
```
:::

## Переменные

Запросы GritQL также могут содержать _переменные_. Следующий запрос будет соответствовать любому вызову
`console.log()` независимо от переданного сообщения:

```grit
`console.log($message)`
```

Это также будет соответствовать любым методам объекта `console`:

```grit
`console.$method($message)`
```

Одно и то же имя переменной может встречаться несколько раз в одном фрагменте:

```grit
`$fn && $fn()`
```

Это будет соответствовать `foo && foo()` и даже `foo.bar && foo.bar()`, но не
`foo && bar()`.

## Условия

Вы можете добавлять условия к шаблонам, используя оператор `where`. Обычно это используется
вместе с _оператором сопоставления_, `<:`:

```grit
`console.$method($message)` where {
    $method <: `log`
}
```

Этот запрос идентичен шаблону `console.log($message)`, который мы видели ранее,
но он становится быстро более интересным, когда мы добавляем другие операторы:

```grit
`console.$method($message)` where {
    $method <: or { `log`, `info`, `warn`, `error` }
}
```

## Сопоставление с синтаксическими узлами Biome

Для более точных запросов вы можете сопоставлять напрямую с внутренними синтаксическими узлами Biome. Каждый узел идентифицируется уникальным именем в `PascalCase`.

Например, чтобы найти все JavaScript выражения `if`, вы можете сопоставить узел `JsIfStatement`:

```grit
engine biome(1.0)
language js(typescript,jsx)

JsIfStatement() as $stmt where {
  register_diagnostic(
    span=$stmt,
    message="Found an if statement"
  )
}
```

Вы можете узнать имена узлов для вашего кода, исследуя синтаксическое дерево в [Biome Playground](https://biomejs.dev/playground/). Полный список всех доступных узлов также доступен в файлах `.ungram` в директории [`xtask/codegen`](https://github.com/biomejs/biome/tree/main/xtask/codegen) репозитория Biome.

:::caution
Грамматика Biome может меняться между версиями, особенно для новых языков. Это может привести к изменению имен узлов, что может нарушить ваши шаблоны. Будьте готовы обновить свои запросы при обновлении Biome.
:::

## Документация по языку

Для получения дополнительной информации о GritQL и его синтаксисе см. официальную
[документацию по языку GritQL](https://docs.grit.io/language/overview).

Имейте в виду, что Biome (пока) не поддерживает все возможности Grit.

## Статус интеграции

Поддержка GritQL в Biome активно развивается. Многое уже работает,
но ошибки все еще ожидаются, а некоторые функции все еще отсутствуют.

Для получения подробного обзора того, какие функции GritQL поддерживаются, а какие
все еще находятся в разработке, см. GitHub issue:
https://github.com/biomejs/biome/issues/2582.

У нас также есть подробный RFC, который определяет направление для наших усилий по плагинам:
https://github.com/biomejs/biome/discussions/1762

**Резюме**: Мы работаем над поддержкой плагинов, которые могут быть либо чистыми GritQL
плагинами, либо JS/TS плагинами, которые используют GritQL для выбора кода, с которым они хотят работать.
Следите за новостями!
