---
title: Обновление до Biome v2
description: Узнайте, как обновиться до Biome v2
---
import PackageManagerCommand from "@/components/PackageManagerCommand.astro";
import PackageManagerBiomeCommand from "@/components/PackageManagerBiomeCommand.astro";
import EditorSettings from "@/components/EditorSettings.astro";
import {FileTree, Steps} from '@astrojs/starlight/components';


Если у вас есть проект, использующий Biome v1, и вы хотите обновиться до v2, это руководство предоставит всю информацию,
которая вам нужна.

## Обновление через CLI

<Steps>
    <ol>
        <li>

            Используйте ваш пакетный менеджер для установки версии `2.0.6` Biome:
            <PackageManagerCommand
                npm="install --save-dev --save-exact @biomejs/biome@2.0.6"
                pnpm="add --save-dev --save-exact @biomejs/biome@2.0.6"
                yarn="add --dev --exact @biomejs/biome@2.0.6"
                bun="add --dev --exact @biomejs/biome@2.0.6"
                deno="add --dev npm:@biomejs/biome@2.0.6" />
        </li>
        <li>
            Запустите команду `migrate` для обновления конфигурации:
            <PackageManagerBiomeCommand command="migrate --write" />
        </li>
        <li>
            Всё готово! Команда `migrate` должна была обновить вашу конфигурацию, чтобы *смягчить* возможные [критические изменения](#breaking-changes). Однако проверьте вывод команды; в некоторых случаях возможно, что вам нужно будет выполнить некоторые ручные шаги. Если так, команда migrate укажет на них.
        </li>
    </ol>
</Steps>



## Критические изменения

Хотя проект и команда стремятся сократить количество критических изменений, v2 содержит некоторые нарушения совместимости, которые стоит объяснить. Этот раздел расскажет о наиболее значимых из них, объяснит причины критического изменения и предоставит решение, если применимо.

### Функции, связанные с Rome, больше не поддерживаются

Все функции, связанные со старым проектом Rome, больше не поддерживаются. Если вы все еще полагались на эти функции, вы должны обновить свой проект:
- переименовать `rome.json` в `biome.json`;
- переименовать `// rome-ignore` в `// biome-ignore`;
- переименовать `ROME_BINARY` в `BIOME_BINARY`;
- формат комментария подавления `// biome-ignore lint(<GROUP_NAME>/<RULE_NAME>): <explanation>` больше не поддерживается. Вместо этого используйте `// biome-ignore lint/<GROUP_NAME>/<RULE_NAME>: <explanation>`.

### Опция `--config-path` удалена

Опция CLI `--config-path` удалена из команд `biome lsp-proxy` и `biome start`.

Опция переопределяла путь конфигурации для всех рабочих пространств, открытых в демоне Biome, что приводило к проблеме несоответствия конфигурации, когда несколько проектов открыты в некоторых редакторах или IDE.

Если вы используете редактор, совместимый с LSP, вы можете использовать его настройки для определения пути конфигурации проекта.

<EditorSettings zed={{ name: "configuration_path", value: "\"./frontend/biome.json\""}} vsCode={{ name: "configurationPath", value: "\"./frontend/biome.json\"" }}></EditorSettings>

Если вы разработчик плагина, пожалуйста, обновите свой плагин, чтобы использовать ответ `workspace/configuration` вместо использования аргумента `--config-path`. LSP Biome автоматически разрешит конфигурацию в рабочем пространстве, поэтому рекомендуется оставить его пустым, если вы не используете пользовательский путь конфигурации.

### Опции `ignore` и `include` удалены и заменены на `includes`

Если вы уже запустили команду `migrate`, у вас не должно быть регрессий. Причина, по которой эти два поля были объединены в одно новое, заключается в том, что реализация старого glob-движка Biome была неполноценной, вызывая некоторые крайние случаи, которые мы не могли исправить без замены нашего движка. К сожалению, мы не могли сделать это без критических изменений.

Предыдущий glob-движок добавлял в начало паттерн `**/` к любому предоставленному пользователем glob. Это означает, что glob `src/**` всегда конвертировался в `**/src/**`, вызывая некоторое неожиданное поведение в некоторых случаях:

|             | `/projectA/src/file.js`     | `src/file.js`     | `/projectB/frontend/src/file.js` |
|-------------|-----------------------------|-------------------|----------------------------------|
| `src/**`    | Glob *не* совпадает с путем | Glob совпадает с путем | Glob *не* совпадает с путем      |
| `**/src/**` | Glob совпадает с путем           | Glob совпадает с путем | Glob совпадает                     |

Как вы можете видеть, glob `**/src/**` является **слишком** жадным, и он совпадает с путями, с которыми не должен был, например `/Users/www/projectB/frontend/src/file.js`.

С v2 Biome **не будет добавлять `**/`** к globs больше.

В предыдущем glob-движке паттерн `*` совпадал с любой последовательностью символов, включая разделитель путей `/`.
Это означает, что glob `**/src/*.js` всегда конвертировался в `**/src/**/*.js`.
С v2 Biome `*` **не будет совпадать с разделителем путей `/`**.

### Пути и globs теперь относительны к конфигурационному файлу

В v1 globs и файлы, объявленные в конфигурационном файле, были относительны к рабочей директории. Это поведение могло вызвать некоторое неожиданное поведение, особенно при переходе с других инструментов.

В следующем примере конфигурационный файл находится в корне проекта, команда `check` запускается из подкаталога и настроена для анализа только файлов внутри папки `src/`.

<FileTree>
    - biome.json
    - src/
        - deploy.js
    - ui/
        - package.json
        - src/
            - main.tsx
            - utils.ts
</FileTree>

```json title="ui/package.json"
{
  "name": "@org/ui",
  "publish": false,
  "scripts": {
    "check": "biome check"
  }
}
```

```json title="biome.json"
{
  "files": {
    "includes": ["src/**"]
  }
}
```

В **v1**, когда вы запускаете `npm run check`, происходит следующее:
- Biome ищет `biome.json` внутри `ui/`
- конфигурационный файл не найден, Biome начинает проверять родительские папки
- Biome находит `biome.json` **в родительской папке**
- *рабочая директория* - `ui/`, потому что именно там была запущена команда CLI
- Biome добавляет `ui/` к `src/**`
- glob `ui/src/**` совпадает с `ui/src/main.tsx` и `ui/src/utils.ts`, но не совпадает с `src/deploy.js`
- два файла анализируются

В **v2**, когда вы запускаете `npm run check`, происходит следующее:
- Biome ищет `biome.json` внутри `ui/`
- конфигурационный файл не найден, Biome начинает проверять родительские папки
- Biome находит `biome.json` **в родительской папке**
- glob `src/**` не совпадает с `ui/src/main.tsx` и `ui/src/utils.ts`, но совпадает с `src/deploy.js`
- один файл анализируется

Чтобы соответствовать предыдущему поведению, glob должен быть обновлен до `ui/src/**`:

```json title="biome.json" mark="ui/src/**" ins={3}
{
  "files": {
    "includes": ["ui/src/**"]
  }
}
```

### Опция `all` удалена из линтера

В самых ранних версиях Biome мы представили `all` как средство включения всех правил линтера или включения всех правил, принадлежащих группе. В то время у Biome было мало правил, и их стоимость обслуживания была очень низкой для сопровождающих и конечных пользователей. Мы не думали дважды и просто добавили это.

Теперь у Biome более 300 правил, и некоторые из этих правил *конфликтуют друг с другом*, вызывая ситуации, когда проект не может исправить нарушения правил, потому что одно исправление вызывает другое правило, и наоборот.

Мы решили **сделать шаг назад**, удалить опцию и ввести её в будущем в какой-то другой форме, возможно, с другой семантикой и конфигурацией. Мы понимаем, что это критическое изменение может вызвать некоторые неудобства.

Сопровождающие проекта уже обсуждают тему в Discord и [GitHub](https://github.com/biomejs/biome/issues/5764). Вам предлагается принять участие в разговоре и помочь нам найти хорошее решение.

В качестве *ограниченного* обходного пути вы можете включить рекомендуемые правила и включить все домены линтера. Однако вы не можете отключить отдельные правила, а домены `react` и `solid` включают правила, которые конфликтуют друг с другом:

```json title="biome.json"
{
  "linter": {
    "domains": {
      "next": "all",
      "react": "all",
      "test": "all",
      "solid": "all",
      "project": "all"
    },
    "rules": {
      "recommended": true
    }
  }
}
```

### Синтаксис `assert` больше не поддерживается

Синтаксис `assert`, который достиг Stage 3, больше не поддерживается и был заменен синтаксисом `with`.

Все LTS-версии Node.js поддерживают новый синтаксис, а также все браузерные движки и безсерверные среды выполнения.

```diff mark="with" mark="assert"
-import {test} from "foo.json" assert { for: "for" }
-export * from "mod" assert { type: "json" }
+import {test} from "foo.json" with { for: "for" }
+export * from "mod" with { type: "json" }
```

### Линтер работает по-другому

В v1 линтер работал следующим образом:
- рекомендуемые правила по умолчанию выдают только диагностику с ошибкой;
- нерекомендуемые правила нужно было включать вручную, и пользователь должен был решить, какую серьезность использовать.

Этот способ работы немного отличался от других линтеров (ESLint, clippy, golint и т.д.), и был очень ограниченным.

В v2 линтер работает, как другие линтеры, что означает следующее:
- каждое правило связано с уровнем серьезности по умолчанию, предложенным Biome;
- рекомендуемые правила могут выдавать диагностику разной серьезности;
- пользователи теперь могут воспользоваться серьезностью правила по умолчанию или выбрать серьезность самостоятельно.

Если вы полагались на рекомендуемые правила, чтобы всегда выдавать ошибку, команда `biome migrate` установит серьезность этих правил на `"error"`.

### Правила `style` больше не выдают ошибки

Мы получили много отличных отзывов в последние месяцы относительно наших рекомендуемых правил. Мы поняли, что сложно сбалансировать "рекомендуемый" набор правил для наших пользователей. Хотя некоторым очень понравились наши значения по умолчанию, другие думали, что они были слишком шумными.

С v2 все правила, принадлежащие к группе `style`, не будут выдавать ошибку, если не настроено иное. Команда `biome migrate` обновит конфигурацию, чтобы они все еще выдавали ошибки, если у вас они были включены. Убедитесь, что конфигурация соответствует вашим стандартам.

### Другое форматирование по умолчанию для `package.json`

Biome теперь форматирует `package.json` с другими значениями по умолчанию. Теперь объекты и массивы всегда форматируются на нескольких строках, независимо от их ширины:

``` diff title="package.json"
-{ "name": "project", "dependencies": { "foo": "^1.0.0" } }
+{
+ "name": "project",
+ "dependencies": {
+   "foo": "^1.0.0"
+ }
+}
```

Если вам нравился предыдущий стиль форматирования, вам придется добавить переопределение в конфигурацию и использовать `"auto"` в качестве значения опции `expand`:

```json title="biome.json" ins={6}
{
  "overrides": [{
    "includes": ["package.json"],
    "json": {
      "formatter": {
        "expand": "auto"
      }
    }
  }]
}
```

### Организатор импортов сортирует импорты по-другому

Biome v2 поставляется с новым организатором импортов с множеством новых функций:

- он поддерживает настройку сортировки;
- он организует операторы `export`;
- он игнорирует пустые строки между операторами `import`;
- он объединяет `import`/`export`;
- его сортировка по умолчанию более последовательна, чем раньше.

Все эти изменения могут привести к другой сортировке импортов и экспортов вашего проекта.
Конфигурация также была перемещена из выделенного поля `organizeImports` в [действие assist](/assist/).
`biome migrate` позаботится о перемещении конфигурации следующим образом:

```diff title="biome.json"
  {
-    "organizeImports": { "enabled": true }
+    "assist": { "actions": { "source": { "organizeImports": "on" } } }
  }
```

Одно значительное различие между старыми и новыми сортировщиками по умолчанию заключается в том, что модули Node.js без протокола `node:` больше не размещаются перед другими импортами.
Например, следующие импорты были отсортированы в Biome 1.x:

```js
import fs from "node:fs";
import path from "path";
import pkg from "@a/package";
```

В Biome 2.0 они сортируются следующим образом:

```js
import fs from "node:fs";
import pkg from "@a/package";
import path from "path";
```

Чтобы восстановить старое поведение, используйте пользовательский порядок следующим образом:

```json5 title="biome.jsonc"
{
    "assist": {
        "actions": {
            "source": {
                "organizeImports": {
                    "level": "on",
                    "options": {
                        "groups": [
                            // модули Bun
                            ":BUN:",
                            // модули Node.js
                            ":NODE:",
                            // модули, импортированные с протоколом `npm:`
                            ["npm:*", "npm:*/**"],
                            // модули, импортированные с другим протоколом. например, `jsr:`
                            ":PACKAGE_WITH_PROTOCOL:",
                            // URLs
                            ":URL:",
                            // библиотеки
                            ":PACKAGE:",
                            // абсолютные пути
                            ["/**"],
                            // Sharp-алиасы
                            ["#*", "#*/**"],
                            // все остальные пути
                            ":PATH:"
                        ]
                    }
                }
            }
        }
    }
}
```

Обратите внимание, что невозможно достичь точно такого же поведения, как Biome v1.x.
Мы рекомендуем использовать новое значение по умолчанию, которое гораздо более последовательно и проще.

Прочитайте [документацию организатора импортов](/assist/actions/organize-imports/) для получения дополнительных сведений.

### Расширение Zed `v0.2.0` несовместимо с v1

Новая версия расширения Zed несовместима с Biome v1, потому что `--config-path` больше не поддерживается. Команда
попыталась сохранить обратную совместимость, но, к сожалению, Zed имеет очень ограниченные возможности отладки для авторов расширений.

### Расширение VS Code v3 требует полной перезагрузки

Хотя это не связано напрямую с Biome v2, новая версия расширения VS Code использует другой метод для подключения к
демону Biome. Если вы обновите расширение, возможно, вы можете столкнуться с **неправильным кодом** при сохранении, если вы используете `"source.fixAll.biome": "explicit"`.
Чтобы исправить это, вам нужно:
1. обновить расширение;
1. закрыть редактор;
1. убить возможные зависшие процессы `biome`;
1. перезапустить редактор;
