---
title: Исследование медлительности в Biome
description: Руководство по выяснению того, какие файлы медленно обрабатываются в Biome
---

Biome должен быть быстрым. _Очень быстрым._ И все же иногда случается, что мы
не можем выполнить это обещание. Чаще всего причиной является конкретный файл или
зависимость, которая вызывает проблемы. Или иногда вы случайно забываете игнорировать
папку `dist/` или `build/`. Какой бы ни была причина, может быть сложно выяснить,
что вызывает эту медлительность, поэтому это руководство предназначено, чтобы помочь вам разобраться
в этом.

## Начнем с самого начала

Прежде чем углубляться слишком глубоко, мы можем выполнить несколько шагов, чтобы увидеть, вызвана ли наша проблема
одним из следующих:

* если у вас есть папка `dist/` или `build/` с выходными файлами или другие такие
  папки с минифицированными файлами, пожалуйста, проверьте, будет ли их игнорирование с помощью
  [`files.experimentalScannerIgnores`](https://biomejs.dev/reference/configuration/#filesexperimentalscannerignores),
  а также
  [`files.includes`](https://biomejs.dev/reference/configuration/#filesincludes)
  иметь значение;
* у вас включены [проектные правила](/linter/domains/#project)? Известно, что они
  вызывают снижение производительности в обмен на более продвинутый анализ. Также см.
  нашу [запись в FAQ](/linter/#why-is-biome-linter-so-slow-compared-to-v1) по этой
  теме. Посмотрите, будет ли их отключение иметь значение;
  * если их отключение помогло, но вы хотите выяснить, что именно сделало
    это таким медленным, первым шагом может быть добавление `node_modules` в
    [`files.experimentalScannerIgnores`](https://biomejs.dev/reference/configuration/#filesexperimentalscannerignores).
    Это помогло? Отлично! Но вы, вероятно, не хотите оставлять это так,
    потому что информация о типах из зависимостей больше не будет доступна. Вы
    можете дополнительно настроить `files.experimentalScannerIgnores`, чтобы игнорировать определенную
    зависимость вместо всей папки `node_modules`, но вы,
    вероятно, захотите прочитать дальше, чтобы выяснить, какую зависимость игнорировать...

Если ничего из вышеперечисленного не помогло, или если помогло, но вы хотите копнуть глубже, мы
можем использовать трассировку, чтобы увидеть, есть ли конкретный файл, который может быть виновником...

## Трассировка

Начиная с версии 2.0, Biome имеет улучшенные возможности трассировки, которые помогают в этом
исследовании. В частности, мы будем комбинировать следующие аргументы командной строки:

* каждой команде CLI Biome можно передать аргумент `--log-file=<path>`, который
  будет записывать все лог-сообщения для этого вызова по указанному пути вместо
  stdout;
* параметр `--log-level=<level>` принимает значение `tracing`. Когда
  используется `--log-level=tracing`, Biome также печатает информацию о времени из
  трассировочных спанов в лог;
* используя `--log-kind=json`, мы можем запросить у Biome запись логов в формате JSON.

Если мы объединим эти три аргумента, мы можем создать файл лога с JSON-сообщениями,
содержащими всю необходимую информацию о времени для Biome. Например:

```sh
biome lint --log-level=tracing --log-kind=json --log-file=tracing.json
```

Это записывает файл `tracing.json`, но он может содержать _много_ данных. Поэтому мы будем
использовать [`jq`](https://github.com/jqlang/jq) для фильтрации этой информации.

Например, если вы хотите выяснить, какие пути занимают больше всего времени при
построении графа модулей, вы можете использовать следующую команду:

```sh
cat tracing.json | jq 'select(.span.name == "update_module_graph_internal") | { path: .span.path, time_busy: .["time.busy"], time_idle: .["time.idle"] }' > filtered.json
```

Теперь у вас будет файл под названием `filtered.json` со всеми необходимыми таймингами,
вместе с путями, используемыми во время вызовов.

Аналогично, если вы хотите выяснить, какие файлы были медленнее всего для анализа, вы
можете использовать следующую команду:

```sh
cat tracing.json | jq '. | select(.span.name == "pull_diagnostics") | { path: .span.path, time_busy: .["time.busy"], time_idle: .["time.idle"] }' > filtered.json
```

Другие имена спанов, из которых может быть интересно извлечь информацию:

* `format_file` сообщает вам, сколько времени занимает форматирование файлов;
* `open_file_internal` сообщает вам, сколько времени занимает открытие файлов, включая парсинг.
  Он имеет поле `reason`, которое также может сообщить вам _почему_ файл открывается: либо
  сканером, обновляется наблюдателем, или запросом клиента, который обычно
  для линтинга или форматирования. _(начиная с Biome 2.1.2)_
