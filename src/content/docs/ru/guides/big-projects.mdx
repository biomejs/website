---
title: Использование Biome в больших проектах
description: Краткое руководство по настройке Biome в больших проектах
---

import {FileTree, Steps} from '@astrojs/starlight/components';

Biome может предоставить некоторые инструменты, которые помогут вам правильно использовать его в больших
проектах, таких как монорепозитории или рабочие пространства, содержащие несколько проектов.

## Использование нескольких конфигурационных файлов

Когда вы используете функции Biome — либо через CLI, либо через LSP — инструмент ищет
ближайший конфигурационный файл, используя текущую рабочую директорию.

Если Biome не находит конфигурационный файл там, он **начинает обход
вверх** по директориям файловой системы, пока не найдет его.

Вы можете использовать эту функцию для применения разных настроек в зависимости от
проекта/папки.

Предположим, у нас есть проект, содержащий бэкенд-приложение и фронтенд-приложение.

<FileTree>
  - app
    - backend
      - biome.json
      - package.json
    - frontend
      - biome.json
      - legacy-app
        - package.json
      - new-app
        - package.json
</FileTree>

Это означает, что когда вы запускаете Biome внутри `app/backend`, Biome будет использовать
конфигурационный файл `app/backend/biome.json`. А когда вы запускаете из
`app/frontend/legacy-app` или `app/frontend/new-app`, Biome будет использовать
конфигурационный файл `app/frontend/biome.json`.

## Монорепозиторий

Монорепозитории — это особые репозитории, в которых несколько пакетов хранятся и
поддерживаются в одном большом репозитории. Каждый пакет может содержать свою
собственную конфигурацию.

Начиная с версии v2, Biome поддерживает монорепозитории из коробки, и вам нужно будет настроить
проект следующим образом.

<Steps>
1. Создайте файл `biome.json` в корне монорепозитория. Мы будем использовать
    рекомендуемые правила и настроим параметры форматтера:

    ```json title="biome.json"
    {
        "linter": {
            "enabled": true,
            "rules": {
                "recommended": true
            }
        },
        "formatter": {
            "lineWidth": 120,
            "indentStyle": "space",
            "indentWidth": 6
        }
    }
    ```
    Этот файл называется **корневой конфигурацией** и устанавливает базовые параметры
    внутри проекта. Однако вложенные конфигурации могут решить придерживаться
    этих параметров или нет. Давайте посмотрим, как это сделать.

2. Создайте вложенные конфигурационные файлы, по одному в каждом пакете, где это необходимо.
    Эти вложенные конфигурационные файлы должны иметь поле `"root"`, установленное в
    `false`. Также мы хотим, чтобы эти пакеты следовали стандартам форматирования,
    установленным в корневой конфигурации. Для этого мы будем использовать **новый
    микросинтаксис**, доступный в Biome v2, который представляет собой `"extends": "//"`. Этот синтаксис
    говорит Biome расширить **корневую конфигурацию**, независимо от того, где находится
    вложенная конфигурация.

    Давайте создадим два конфигурационных файла, один внутри `packages/logger` и один
    внутри `packages/generate`. В первом мы отключим `noConsole`, а
    в `packages/generate` мы отключим форматтер, потому что это файлы,
    которые генерируются кодом:

    ```json title="packages/logger/biome.json"
    {
        "root": false,
        "extends": "//",
        "linter": {
            "rules": {
                "suspicious": {
                    "noConsole": "off"
                }
            }
        }
    }
    ```

    ```json title="packages/generate/biome.json"
    {
        "root": false,
        "extends": "//",
        "formatter": {
            "enabled": false
        }
    }
    ```
    Для удобства, когда вы используете микросинтаксис `extends: "//"`, вы можете
    **опустить** `"root": false`, потому что уже подразумевается, что эта
    конфигурация не является корневой:

    ```diff title="packages/generate/biome.json"
    {
    -   "root": false,
        "extends": "//",
        "formatter": {
        "enabled": false
    }
    ```
3. Теперь предположим, что у нас есть новый пакет в `packages/analytics`, который
    поддерживается другой командой. Эта команда следует совершенно другим стандартам кодирования,
    поэтому они _не_ хотят наследовать параметры из корневой
    конфигурации. Для них им просто нужно опустить `"extends": "//"` из
    конфигурационного файла и изменить параметры форматирования:
    ```json title="packages/analytics/biome.json"
    {
        "root": false,
        "formatter": {
            "lineWidth": 100,
        }
    }

    ```
4. Теперь, когда всё настроено, у вас есть несколько вариантов. Вы можете запускать команды `biome`
    из корня проекта или из отдельных пакетов. Biome
    будет соблюдать все настройки!
</Steps>

:::tip
Иногда Biome может найти вложенный конфигурационный файл, который не имеет
правильной настройки `"root": false`. Это может произойти, если у вас есть другой проект,
который использует Biome в папке vendor или Git-подмодуле, например. В таком
случае мы предлагаем полностью игнорировать вложенный проект, используя
[поле `files.includes`](/ru/reference/configuration/#filesincludes).
:::

## Другие способы совместного использования конфигурационного файла

Как мы видели выше, поле `extends` позволяет вам разделить вашу конфигурацию
между несколькими файлами. Таким образом, вы можете делиться общими настройками между различными
проектами или папками. Синтаксис `"extends": "//"` является удобным ярлыком, когда
вы хотите, чтобы вложенные конфигурации расширяли корневую конфигурацию, но
иногда вам может понадобиться использовать еще более настраиваемую настройку.

Помимо `"//"`, настройка `extends` принимает также значения в виде массива. В этом
случае каждое значение в массиве должно быть путем к другой конфигурации для расширения.

Например, вот как вы можете настроить свою конфигурацию для расширения
конфигурационного файла `common.json`:

```json title="biome.json"
{
  "extends": ["./common.json"]
}
```

Записи, определенные в `extends`, разрешаются из пути, где определен
файл `biome.json`. Они обрабатываются в порядке их перечисления,
при этом настройки в более поздних файлах переопределяют более ранние.

Файлы, которые вы `extend`, не могут в свою очередь `extend` другие файлы.

Обратите внимание, что пути в конфигурационном файле всегда разрешаются из папки, в
которой находится файл `biome.json`/`biome.jsonc`. При использовании поля `extends`
это означает, что пути в общей конфигурации интерпретируются из
местоположения конфигурации, которая её расширяет, а не из папки
расширяемого файла.

Например, предположим, что проект содержит две директории `backend/` и
`frontend/`, каждая из которых имеет свой `biome.json`, оба расширяющие конфигурацию `common.json`
в корневой папке:

<FileTree>
- backend/
  - src/
    - ...
  - test/
    - ...
  - biome.json
- frontend/
  - src/
    - ...
  - test/
    - ...
  - biome.json
- common.json
</FileTree>

```json title="common.json"
{
  "files": {
    "includes": ["src/**/*.js", "test/**/*.js"],
  },
  "linter": {
    "includes": ["**", "!test"]
  }
}
```

```json title="frontend/biome.json"
{
  "extends": ["../common.json"]
}
```

* при запуске Biome из папки `frontend/` он будет настроен на
  форматирование и линтинг всех JavaScript-файлов в папках `frontend/src/` и
  `frontend/test/`, и только форматирование файлов в папке `frontend/src/`.
  Это работает, потому что пути, указанные в `common.json`, интерпретируются из папки `frontend/`, потому что именно там находится файл `biome.json`;
* предполагая, что `backend/biome.json` выглядит так же, как `frontend/biome.json`, он будет
  иметь такое же поведение, за исключением того, что пути будут интерпретироваться из
  папки `backend/`.

Обратите внимание, что в этой настройке и `frontend/biome.json`, и `backend/biome.json` считаются
корневыми конфигурациями. Вы не сможете запустить Biome из корня
репозитория, если не используете опцию CLI `--config-path` и не укажете её на
одну из конфигураций.

### Экспорт конфигурации Biome из NPM-пакета

Biome также может разрешать конфигурационные файлы из папки `node_modules/`.
Таким образом, вы можете экспортировать свой конфигурационный файл из пакета и импортировать его
в несколько проектов.

Для этого первое, что нужно сделать, это настроить вашу "общую" конфигурацию Biome
определенным образом. Предположим, вы хотите поделиться
конфигурацией из пакета под названием `@org/shared-configs`, используя спецификатор
`@org/shared-configs/biome`. Вам нужно создать запись `exports` в
`package.json` этого пакета:

```json title="package.json" ins={5,3}
{
  "name": "@org/shared-configs",
  "type": "module",
  "exports": {
    "./biome": "./biome.json"
  }
}
```

Убедитесь, что `@org/shared-configs` правильно установлен в вашем проекте, и
обновите файл `biome.json`, чтобы он выглядел как следующий фрагмент:

```json title="biome.json"
{
  "extends": ["@org/shared-configs/biome"]
}
```

Biome попытается разрешить вашу библиотеку `@org/shared-configs/` из вашей
рабочей директории. Рабочая директория — это:

- при использовании CLI — папка, из которой вы выполняете свои скрипты.
  Обычно она совпадает с местоположением вашего файла `package.json`;
- при использовании LSP — корневая папка вашего проекта.

:::caution
Пути, начинающиеся с точки `.` или заканчивающиеся на `.json` или `.jsonc`, всегда
рассматриваются как относительные пути, поэтому они не будут разрешаться из `node_modules/`.
:::

Для получения дополнительной информации об алгоритме разрешения обратитесь к
[документации Node.js](https://nodejs.org/api/esm.html#resolution-and-loading-algorithm).
