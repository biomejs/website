---
title: Import文のソート
description: BiomeのImport文のソート
---

Biomeは、import文を[自然順](https://ja.wikipedia.org/wiki/自然順)に従ってソートします。

この機能はデフォルトで有効ですが、以下のように設定を通じてオプトアウトすることができます。

```json
{
  "organizeImports": {
    "enabled": false
  }
}
```

:::note
Import文のソート機能は不要なインポートを削除しません。
不要なインポートを削除する安全な修正を持つリンタのルール [noUnusedImports](/linter/rules/no-unused-imports/) を提供しています。
:::

## Import文のソート方法

import文は、"距離" によってソートされます。ユーザーから "遠い" モジュールが上に配置され、ユーザーに "近い" モジュールが下に配置されます。

1. `bun:`プロトコルを介してインポートされたモジュール。これはBunによって実行されるコードを書く場合に適用されます。
2. `node:`プロトコルを使用して明示的にインポートされるNode.jsの組み込みモジュールおよび`assert`などの一般的なNodeビルトイン。
3. `npm:`プロトコルを介してインポートされたモジュール。これはDenoで実行されるコードを書く場合に適用されます。
4. `:`プロトコルを介してインポートされたモジュール。これは"バーチャルモジュール"と呼ばれ、`vite`などの作業環境によって注入されます。
5. URLを介してインポートされたモジュール。
6. ライブラリからインポートされたモジュール。
7. 絶対インポート (absolute import) を使用してインポートされたモジュール。
8. `#`の接頭辞が付いた名前からインポートされたモジュール。これは、[Nodeのサブパスインポート](https://nodejs.org/api/packages.html#subpath-imports)を使用する場合に適用されます。
9. 相対インポート (relative import) を使用してインポートされたモジュール。
10. 前述の基準で識別できなかったモジュール。

例えば、次のコードが与えられた場合、

```ts title="example.ts"
import uncle from "../uncle";
import sibling from "./sibling";
import express from "npm:express";
import imageUrl from "url:./image.png";
import { sortBy } from "virtual:utils";
import assert from "node:assert";
import aunt from "../aunt";
import { VERSION } from "https://deno.land/std/version.ts";
import { mock, test } from "node:test";
import { expect } from "bun:test";
import { internal } from "#internal";
import { secret } from "/absolute/path";
import React from "react";
```

次のようにソートされます。

```ts title="example.ts"
import { expect } from "bun:test";
import assert from "node:assert";
import { mock, test } from "node:test";
import express from "npm:express";
import { sortBy } from "virtual:utils";
import { VERSION } from "https://deno.land/std/version.ts";
import React from "react";
import { secret } from "/absolute/path";
import { internal } from "#internal";
import aunt from "../aunt";
import uncle from "../uncle";
import sibling from "./sibling";
import imageUrl from "url:./image.png";
```

ソートを適用する方法は、[CLIを使用した場合](#cliを使用した場合)または[VS Code拡張機能を使用した場合](#vs-code拡張機能を使用した場合)の2つあります。

## グループインポート

主にフロントエンドのプロジェクトで作業する場合やCSSファイルをインポートする際には、特定の順序でimport文を宣言することは一般的です。

```js title="example.js"
import "../styles/reset.css";
import "../styles/layout.css";
import { Grid } from "../components/Grid.jsx";
```

他の一般的なケースは、polyfillやshimファイルをインポートすることです。これらはファイルの先頭に配置する必要があります。

```js title="example.js"
import "../polyfills/array/flatMap";
import { functionThatUsesFlatMap } from "./utils.js";
```

こういったケースでは、Biomeがimport文をすべてソートすることによりアプリケーションの従来の挙動を**壊す**可能性があります。

これを回避するためにはimport文の"グループ"を作成します。**改行**を追加することでグループに区切ることができます。

これによりBiomeは、ソートの対象をグループに属するimport文のみに制限します。

```js title="example.js"
// group 1, only these two files will be sorted
import "../styles/reset.css";
import "../styles/layout.css";

// group 2, only this one is sorted
import { Grid } from "../components/Grid.jsx";
```

```js title="example.js"
// group 1, the polyfill/shim
import "../polyfills/array/flatMap";

// group 2, the files that require the polyfill/shim
import { functionThatUsesFlatMap } from "./utils.js";
```

## 副作用のインポート

[副作用のインポート](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/import#%E5%89%AF%E4%BD%9C%E7%94%A8%E3%81%AE%E3%81%9F%E3%82%81%E3%81%A0%E3%81%91%E3%81%AB%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%92%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B) はいかなる名前もインポートしないimport文です：

```js
import "./global.js"
```

モジュールがどのような副作用をもたらすかを判断することは難しいため、import文のソート機能は副作用のインポートがそれぞれのグループを成すと仮定します。

例えば、以下のimport文は4つのグループから成ります：

```js name="file.js"
import sibling from "./sibling";       // Import group 1
import { internal } from "#internal";  // Import group 1
import "z";  // Import group 2
import "a";  // Import group 3
import React from "react";         // Import group 4
import assert from "node:assert";  // Import group 4
```

それぞれのグループは以下のように独立してソートされます：

```js name="file.js"
import { internal } from "#internal";  // Import group 1
import sibling from "./sibling";      // Import group 1
import "z";  // Import group 2
import "a";  // Import group 3
import assert from "node:assert";  // Import group 4
import React from "react";         // Import group 4
```

## CLIを使用した場合

オプション`--write`を指定して、`check`コマンドを実行します。Import文のソートのみを行いたい場合は、以下のように`check`コマンドを実行します：

```shell
biome check \
    --formatter-enabled=false\
    --linter-enabled=false \
    --organize-imports-enabled=true \
    --write \
    ./path/to/src
```

## VS Code拡張機能を使用した場合

BiomeのVS Code拡張機能は、_Organize Imports_ コードアクションによるimport文のソートをサポートしています。
このアクションはデフォルトで <kbd title="Shift">⇧</kbd>+<kbd>Alt</kbd>+<kbd>O</kbd> キーボードショートカットを使用して実行するか、
コマンドパレット (<kbd>Ctrl</kbd>/<kbd title="Cmd">⌘</kbd>+<kbd title="Shift">⇧</kbd>+<kbd>P</kbd>) から _Organize Imports_ を選択してアクセスできます。

ファイル保存時に自動で実行したい場合は、エディタの設定に以下を追加することで実現できます。

```json title="settings.json"
{
	"editor.codeActionsOnSave":{
		"source.organizeImports.biome": "explicit"
	}
}
```
