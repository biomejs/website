---
title: パフォーマンスの問題を調査する
description: Biomeでどのファイルが遅いのかを特定するガイド
---

Biomeは高速であることを目指しています。_非常に高速です。_ しかし、時にはその約束を果たせないことがあります。多くの場合、原因は特定のファイルや依存関係です。または、`dist/`や`build/`フォルダを無視し忘れることもあります。原因が何であれ、何が遅延を引き起こしているのかを見つけるのは困難な場合があります。このガイドは、それを特定するのに役立ちます。

## まず最初に

深く掘り下げる前に、問題が以下のいずれかによって引き起こされているかどうかを確認するために、いくつかの手順を実行できます：

- `dist/`や`build/`フォルダに出力ファイルがある場合、またはその他の圧縮されたファイルを含むフォルダがある場合、[`files.includes`](https://biomejs.dev/reference/configuration/#interaction-with-the-scanner)で`!!`構文を使用してそれらを無視することで違いがあるかどうかを確認してください。
- [プロジェクトルール](/linter/domains/#project)が有効になっていますか？これらは、より高度な分析と引き換えにパフォーマンスオーバーヘッドを引き起こすことが知られています。このトピックに関する[FAQエントリ](/ja/linter/#なぜbiomeリンタはv1と比べて遅いのですか)も参照してください。無効にすることで違いがあるかどうかを確認してください。
  - 無効にすることで改善するが、何が具体的に遅くしているのかを知りたい場合、最初のステップとして`**/node_modules`を[`files.includes`](https://biomejs.dev/reference/configuration/#filesincludes)に`!!`構文で追加することができます。
    改善しましたか？素晴らしいです！ただし、依存関係からの型情報が利用できなくなるため、このままにしておきたくないでしょう。`files.includes`をさらに調整して、`node_modules/`フォルダ全体ではなく、特定の依存関係を無視することもできますが、どの依存関係を無視すべきかを特定するには、おそらく読み続ける必要があります。

上記のいずれも役に立たなかった場合、または役に立ったが、さらに深く掘り下げたい場合は、トレーシングを使用して、原因となっている可能性のある特定のファイルがあるかどうかを確認できます。

## トレーシング

バージョン2.0以降、Biomeはこの調査を支援するためにトレーシング機能を改善しました。具体的には、以下のコマンドライン引数を組み合わせます：

- すべてのBiome CLIコマンドに`--log-file=<path>`引数を渡すことができ、その呼び出しのすべてのログメッセージをstdoutの代わりに指定されたパスに書き込みます。
- `--log-level=<level>`パラメータは`tracing`値を受け入れます。`--log-level=tracing`が使用されると、Biomeはトレーシングスパンからのタイミング情報もログに出力します。
- `--log-kind=json`を使用して、BiomeにログをJSON形式で書き込むように要求できます。

これら3つの引数を組み合わせると、Biomeのすべての関連するタイミング情報を含むJSONメッセージのログファイルを作成できます。例えば：

```sh
biome lint --log-level=tracing --log-kind=json --log-file=tracing.json
```

これにより`tracing.json`ファイルが書き込まれますが、*大量の*データが含まれる可能性があります。そのため、[`jq`](https://github.com/jqlang/jq)を使用してこの情報をフィルタリングします。

例えば、モジュールグラフを構築する際にどのパスが最も時間がかかるかを特定したい場合は、次のコマンドを使用できます：

```sh
cat tracing.json | jq 'select(.span.name == "update_module_graph_internal") | { path: .span.path, time_busy: .["time.busy"], time_idle: .["time.idle"] }' > filtered.json
```

これで、`filtered.json`という名前のファイルに、呼び出し中に使用されたパスとともに、すべての関連するタイミング情報が含まれます。

同様に、どのファイルの分析が最も遅かったかを特定したい場合は、次のコマンドを使用できます：

```sh
cat tracing.json | jq '. | select(.span.name == "pull_diagnostics") | { path: .span.path, time_busy: .["time.busy"], time_idle: .["time.idle"] }' > filtered.json
```

情報を取得するのに興味深い可能性のある他のスパン名：

- `format_file`は、ファイルのフォーマットにどのくらい時間がかかるかを示します。
- `open_file_internal`は、ファイルのオープン（パースを含む）にどのくらい時間がかかるかを示します。
  これには`reason`フィールドもあり、ファイルが開かれる*理由*も示します：スキャナーによるもの、ウォッチャーによる更新、または通常はリンティングやフォーマットのためのクライアントリクエストです。_（Biome 2.1.2以降）_
